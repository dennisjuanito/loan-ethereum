{"version":3,"file":"static/webpack/static/development/pages/loans/register.js.9d05332f6d1b28c0c8eb.hot-update.js","sources":["webpack:///./pages/loans/register.js"],"sourcesContent":["import React, {Component} from 'react';\nimport {Form, Input, Message, Button} from 'semantic-ui-react';\nimport Layout from '../../components/Layout';\nimport LoanFactory from '../../contracts/LoanFactory.json';\nimport Loan from '../../contracts/Loan.json';\nimport getWeb3 from '../../utils/getWeb3';\nimport CalculateRepayments from '../../utils/calculateRepayments';\nimport {Router} from '../../routes';\n\nexport default class RegisterLoanForm extends Component {\n    state = {\n        loading: false,\n        loanTitle: '',\n        borrowerAddress: '',\n        startDate: '',\n        tenor: '',\n        interestRatePerYear: '',\n        balanceRequested: '',\n        origination: '',\n        gracePeriod: ''\n    };\n\n    onSubmit = async event => {\n        event.preventDefault();\n        this.setState({loading: true}, async () => {\n            try {\n                this.handleLoadingChange(true);\n                const web3 = await getWeb3();\n                const accounts = await web3.eth.getAccounts();\n                const networkId = await web3.eth.net.getId();\n                const deployedNetwork = LoanFactory.networks[networkId];\n\n                const loanFactoryInstance = new web3.eth.Contract(\n                    LoanFactory.abi,\n                    deployedNetwork.address\n                );\n\n                await loanFactoryInstance.methods.createLoan().send({from: accounts[0]});\n\n                let {\n                    loanTitle,\n                    borrowerAddress,\n                    startDate,\n                    tenor,\n                    interestRatePerYear,\n                    balanceRequested,\n                    origination,\n                    gracePeriod\n                } = this.state;\n                let calculationSchedules = CalculateRepayments(\n                    startDate,\n                    tenor,\n                    interestRatePerYear,\n                    balanceRequested,\n                    origination,\n                    gracePeriod\n                );\n\n                const deployedLoanContract = await loanFactoryInstance.methods.getDeployedLoans().call();\n                const deployedLoanContractLength = await loanFactoryInstance.methods\n                    .getDeployedLoansLength()\n                    .call();\n                const loanInstance = new web3.eth.Contract(\n                    Loan.abi,\n                    deployedLoanContract[deployedLoanContractLength - 1]\n                );\n                await loanInstance.methods\n                    .addAllRepaymentSchedules(calculationSchedules, borrowerAddress, loanTitle)\n                    .send({from: accounts[0]});\n                this.handleLoadingChange(false);\n            } catch (error) {\n                // Catch any errors for any of the above operations.\n                alert(`Failed to load web3, accounts, or contract. Check console for details.`);\n                console.error(error);\n                this.handleLoadingChange(false);\n            }\n        });\n    };\n\n    handleLoadingChange = async val => {\n        await this.setState({\n            loading: val\n        });\n\n        !val ? await Router.pushRoute(`/`) : '';\n    };\n\n    render() {\n        return (\n            <Layout>\n                <Form onSubmit={this.onSubmit}>\n                    <h2 className='ui large header'>Register a Loan</h2>\n                    <Form.Field>\n                        <label>Loan Title</label>\n                        <Input\n                            value={this.state.loanTitle}\n                            onChange={event => this.setState({loanTitle: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Borrower Address</label>\n                        <Input\n                            value={this.state.borrowerAddress}\n                            onChange={event => this.setState({borrowerAddress: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Starting Date</label>\n                        <Input\n                            label='YYYY-MM-DD'\n                            labelPosition='right'\n                            value={this.state.startDate}\n                            onChange={event => this.setState({startDate: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Tenor</label>\n                        <Input\n                            label='months'\n                            labelPosition='right'\n                            value={this.state.tenor}\n                            onChange={event => this.setState({tenor: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Balance Requested</label>\n                        <Input\n                            label='rupiah'\n                            labelPosition='right'\n                            value={this.state.balanceRequested}\n                            onChange={event => this.setState({balanceRequested: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Interest Rate Per Year</label>\n                        <Input\n                            label='%'\n                            labelPosition='right'\n                            value={this.state.interestRatePerYear}\n                            onChange={event => this.setState({interestRatePerYear: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Origination</label>\n                        <Input\n                            label='%'\n                            labelPosition='right'\n                            value={this.state.origination}\n                            onChange={event => this.setState({origination: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Form.Field>\n                        <label>Grace Period</label>\n                        <Input\n                            label='months'\n                            labelPosition='right'\n                            value={this.state.gracePeriod}\n                            onChange={event => this.setState({gracePeriod: event.target.value})}\n                        />\n                    </Form.Field>\n                    <Button loading={this.state.loading} type='submit' primary>\n                        Create\n                    </Button>\n                </Form>\n            </Layout>\n        );\n    }\n}\n\n//         loanTitle: 'test form',\n//         borrowerAddress: '0x0bD041752FB439Bd7D43b45d2c914FcfA0dfDD8f',\n//         startDate: '2018-10-07',\n//         tenor: '12',\n//         interestRatePerYear: '24',\n//         balanceRequested: '1500000',\n//         origination: '3',\n//         gracePeriod: '0'\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;;;;;;AAWA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AACA;AADA;AAIA;AAJA;AAAA;AACA;AADA;AAKA;AACA;AAEA;AARA;AAAA;AAaA;AAAA;AACA;AAdA;AAAA;AAyBA;AAzBA;AAAA;AACA;AADA;AAkCA;AAlCA;AAAA;AACA;AADA;AAmCA;AAGA;AAtCA;AAAA;AA4CA;AAAA;AACA;AA7CA;AA6CA;AACA;AA9CA;AAAA;AACA;AADA;AAAA;AAAA;AA+CA;AACA;AACA;AACA;AAAA;AACA;AAnDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;AAwDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AADA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAKA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;;AAOA;AAAA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AAQA;AACA;AAAA;AAAA;AAAA;AAAA;AAFA;AAQA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAUA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAUA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAUA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAUA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAUA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAOA;AAAA;AAAA;AAAA;AAMA;;;;AA7JA;AAiKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}